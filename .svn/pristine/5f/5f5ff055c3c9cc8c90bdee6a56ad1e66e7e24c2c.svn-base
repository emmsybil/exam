<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cw.portal.persistence.ScoreHistoryMapper">

	<!-- 获取总数 -->
	<select id="getCount" resultType="int">
		select count(1) from et_score a, et_field b, et_user c, et_exam d
		<where>
			1=1
			<if test="field_name != null"> and b.field_name=#{field_name}</if>
			<if test="pass != null"> and a.pass=#{pass}</if>
			<if test="examName != null"> and d.exam_name=#{examName}</if>
			and a.stuno=c.user_id
			and a.field_id=b.field_id
			and a.stuno=#{stuNo}
			and a.exam_id=d.id
		</where>
	</select>

	<!-- 分角色/分页/条件查询成绩） -->
	<select id="getScoreByCondition" resultType="com.cw.common.domain.score.Score">
		select a.id id, date_format(a.createTime,'%Y-%m-%d %H:%i') createTime,
		a.creatorId creatorId, date_format(a.examTime,'%Y-%m-%d %H:%i')
		examTime, a.makeup makeUp, a.pass pass, a.score score, a.stuno stuNo,
		a.field_id fieldId, b.field_name fieldName, d.exam_name examName,
		c.true_name trueName
		from et_score a,
		et_field b, et_user c, et_exam d
		<where>
			1=1
			<if test="field_name != null"> and b.field_name=#{field_name}</if>
			<if test="pass != null"> and a.pass=#{pass}</if>
			<if test="examName != null"> and d.exam_name=#{examName}</if>
			and a.stuno=c.user_id
			and a.field_id=b.field_id
			and a.stuno=#{stuNo}
			and a.exam_id=d.id
		</where>
	</select>

	<!-- 查出科目 -->
	<select id="getField" resultType="com.cw.common.domain.score.Score">
		select a.field_id fieldId, a.field_name fieldName
		from et_field a, et_score b
		where a.field_id=b.field_id
		and b.stuno=#{stuNo}
	</select>
	
	<!-- 查出所有考试 -->
	<select id="getExam" resultType="com.cw.common.domain.score.Score">
		select a.exam_id examId, b.exam_name examName
		from et_score a, et_exam b
		where a.exam_id=b.id and a.stuno=#{stuNo}
	</select>

</mapper>